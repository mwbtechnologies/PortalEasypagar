<div>
    <div class="row">
        <div class="row" *ngIf="ShowList">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="display: flex;justify-content: space-between;">
                        <div class="col-md-5">         
                            <h3 class="mb-0 card-title"><label (click)="backToDashboard()" class="mb-0 card-title"><i class="fa fa-chevron-left"></i>
                            </label> &nbsp;Back</h3>
                        </div>
                        <div class="col-md-6">         
                            <h3 class="mb-0 card-title">Loan/Advance Requests</h3>
                        </div>
                        <!-- <div class="col-md-1">         
                            <button class="btn btn-primary" (click)="ApplyLoan()">Apply Loan</button>
                        </div> -->
                    </div>
                    <div class="col-md-12">
                        <div class="row">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-2">
                                        <label class="form-label">From Date</label>
                                        <input placeholder="Select Date" type="date" required FromDate
                                            [(ngModel)]="formInput.FromDate" class="form-control" (change)="dateValidationFD(formInput.FromDate)">

                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">To Date</label>
                                        <input placeholder="Select Date" type="date" required ToDate
                                            [(ngModel)]="formInput.ToDate" (change)="dateValidationTD(formInput.ToDate)"
                                            class="form-control">

                                    </div>
                                    <div class="col-md-2" >
                                        <label class="form-label">Select Organization</label>
                                        <ng-multiselect-dropdown [placeholder]="'All Organizations'" [(ngModel)]="selectedListOrganization" [data]="OrgList"
                                            [settings]="orgListSettings" (onSelect)="onselectedListOrg($event)"
                                            (onDeSelect)="onDeselectedListOrg($event)">
                                        </ng-multiselect-dropdown>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Branch</label>
                                        <ng-multiselect-dropdown [placeholder]="'All Branch'"
                                            [(ngModel)]="selectedBranchId" [data]="Columns"
                                            [settings]="listtypesettings" (onSelect)="onselectedBranchesChange($event)"
                                            (onDeSelect)="onDeselectedBranchesChange($event)">
                                        </ng-multiselect-dropdown>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Department</label> <ng-multiselect-dropdown
                                            [placeholder]="'All Department'" [(ngModel)]="selecteddepartmentId"
                                            [data]="DeptColumns" [settings]="listtypesettings"
                                            (onSelect)="onselectedDepartmentsChange($event)"
                                            (onDeSelect)="onDeselectedDepartmentsChange($event)">
                                        </ng-multiselect-dropdown>
                                    </div>
                                    <div class="col-md-1" style="bottom: -35px;">
                                        <button class="btn btn-primary"
                                            (click)="Search()">Search</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                          <table id="DataTables_Table_0" table datatable [dtOptions]="dtExportButtonOptions"
                            [dtTrigger]="dtTrigger" class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th style="background-color: #3601b51f;text-align: center;">SL No</th>
                                        <th style="background-color: #3601b51f;text-align: center;">Employee Id</th>
                                        <th style="background-color: #3601b51f;text-align: center;">Employee</th>
                                        <th style="background-color: #3601b51f;text-align: center;">Requested On</th>
                                        <th style="background-color: #3601b51f;text-align: center;">Loan Type</th>
                                        <th style="background-color: #3601b51f;text-align: center;">Amount</th>
                                        <!-- <th>DateRange</th> -->
                                        <th style="background-color: #3601b51f;text-align: center;min-width: 200px;">
                                            Reason</th>
                                        <!-- <th>Approved Days</th>
                                        <th>Approved Leave Type</th> -->
                                        <th style="background-color: #3601b51f;text-align: center;">Status</th>
                                        <th style="background-color: #3601b51f;text-align: center;max-width: 150px;">
                                            Approved Amount</th>
                                        <th style="background-color: #3601b51f;text-align: center;max-width: 150px;">
                                            Comment</th>
                                        <!-- <th>Comment</th>
                                        <th>Approved On</th> -->
                                        <th style="background-color: #3601b51f;text-align: center;min-width: 100px;">
                                            Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="ng-star-inserted" *ngFor="let IL of LoanList; let i = index;">
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;"> {{i+1}} </div>
                                        </td>
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;">{{IL.MappedEmpId}}
                                            </div>
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;">{{IL.EmpName}}
                                            </div>

                                        </td>
                                        <td>
                                            <div class="ng-star-inserted">{{IL.RequestDate|date: 'dd-MM-yyyy'}} </div>


                                        </td>
                
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;"> {{IL.LoanType}}
                                            </div>

                                        </td>
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;">
                                                {{IL.RequestedAmount}} </div>

                                        </td>
                                        <!-- <td>
                                            <div class="ng-star-inserted">{{IL.FromDateTime|date: 'dd-MM-yyyy'}} To
                                                {{IL.ToDateTime|date: 'dd-MM-yyyy'}} </div>

                                        </td> -->
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;">
                                                {{IL.ReasonForLoan}} </div>

                                        </td>
                                        <!-- <td>
                                            <div class="ng-star-inserted"> {{IL.ApprovedDays}} </div>

                                        </td>
                                        <td>
                                            <div class="ng-star-inserted"> {{IL.ApprovedLeaveType}} </div>

                                        </td> -->
                                        <td>
                                            <div class="ng-star-inserted" style="text-align: center;">
                                                {{IL.ApproveStatus}} </div>

                                        </td>
                                        <td>
                                            <div style="text-align: center;" *ngIf="IL.ApproveStatus=='Paid'"
                                                class="ng-star-inserted"> {{IL.ApprovedAmount}} </div>
                                            <div style="text-align: center;" *ngIf="IL.ApproveStatus=='Pending'"
                                                class="ng-star-inserted"> 0 </div>
                                            <div style="text-align: center;" *ngIf="IL.ApproveStatus=='Rejected'"
                                                class="ng-star-inserted"> 0 </div>

                                        </td>
                                        <!-- <td>
                                            <div class="ng-star-inserted"> {{IL.AdminComment}} </div>

                                        </td>
                                        <td>
                                            <div class="ng-star-inserted"> {{IL.ApprovedDate|date: 'dd-MM-yyyy'}} </div>

                                        </td> -->

                                        <td>

                                            <textarea style="background-color: white;height: 100px;" type="text"*ngIf="IL.ApproveStatus=='Pending'"
                                                name="example-text-input" class="form-control" id="Comment"
                                                name="Comment" placeholder="Comment" #Comment="ngModel"
                                                [(ngModel)]="IL.Comment"> </textarea>
                                            <textarea disabled style="background-color: white;height: 100px;" *ngIf="IL.ApproveStatus=='Paid' || IL.ApproveStatus=='Rejected'" type="text"
                                                name="example-text-input" class="form-control" id="Comment"
                                                name="Comment" placeholder="Comment" #Comment="ngModel"
                                                [(ngModel)]="IL.Comment"> </textarea>

                                        </td>

                                        <td style="text-align: center;">
                                            <button class="btn btn-sm btn-primary ng-star-inserted"
                                                style="background-color: #3601b5a3;" id="bEdit" type="button"
                                                matTooltip="View {{IL.LoanType}}"><span class="fa fa-eye"
                                                    (click)="openDialog(IL);"></span></button> &nbsp;

                                            <!-- <button style="padding: 2px;" class="btn btn-primary" style="border-radius: 10px;background-color: #3601b5a3;"  id="bEdit"
                                                    type="button"><span class="fa fa-check-circle-o"
                                                        (click)="Approve(IL);"></span></button> -->


                                            <button *ngIf="IL.ApproveStatus === 'Pending'"
                                                class="btn btn-sm btn-danger ng-star-inserted" id="bEdit"
                                                matTooltip="Reject {{IL.LoanType}}" type="button"><span
                                                    class="fa fa-times" (click)="Reject(IL);"></span></button>




                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="ShowAdd">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header" style="justify-content: left;">
                            <div class="col-md-6">
                                <h3 class="mb-0 card-title" (click)="back()"><i class="fa fa-chevron-left" ></i>&nbsp;Back</h3>
                            </div>
                            <div class="col-md-5">
                                <h3 class="mb-0 card-title">Apply Loan</h3>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row justify-content-start">
                                <div class="col-md-3" >
                                    <label class="form-label">Select Organization *</label>
                                    <ng-multiselect-dropdown [placeholder]="'All Organizations'" [(ngModel)]="selectedOrganization" [data]="ApplyOrgList"
                                        [settings]="orgSettings" (onSelect)="onselectedOrg($event)"
                                        (onDeSelect)="onDeselectedOrg($event)">
                                    </ng-multiselect-dropdown>
                                    <label style="color: red;font-size: 12px;" *ngIf="error?.organization">{{ error?.organization }}</label>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Select Branch *</label>
                                    <ng-multiselect-dropdown [placeholder]="'Select Branch'" [data]="ApplyBranchList"
                                        [(ngModel)]="selectedBranch" (onSelect)="onBranchSelect($event)"
                                        (onDeSelect)="onBranchDeSelect($event)" [settings]="branchSettings">
                                    </ng-multiselect-dropdown>
                                    <label style="color: red;font-size: 12px;" *ngIf="error?.branch">{{ error?.branch }}</label>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Select Department</label>
                                    <ng-multiselect-dropdown [placeholder]="'All Department'"
                                        [data]="ApplyDepartmentList" [(ngModel)]="selectedDepartment"
                                        (onSelect)="onDeptSelect($event)" (onSelectAll)="onDeptDeSelectAll()"
                                        (onDeSelectAll)="onDeptDeSelectAll()" (onDeSelect)="onDeptDeSelect($event)"
                                        [settings]="departmentSettings">
                                    </ng-multiselect-dropdown>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Select Employees *</label>
                                    <ng-multiselect-dropdown [placeholder]="'Select Employees'" [data]="EmployeeList"
                                        [(ngModel)]="selectedEmployees" (onSelect)="OnEmployeesChange($event)"
                                        (onDeSelect)="OnEmployeesChangeDeSelect($event)" [settings]="employeeSettings">
                                    </ng-multiselect-dropdown>
                                    <label style="color: red;font-size: 12px;" *ngIf="error?.emloyee">{{ error?.emloyee }}</label>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group"><label class="form-label">Select Loan *</label>
                                        <ng-multiselect-dropdown [placeholder]="'Select Loan'" [data]="LoanTypes"
                                            [(ngModel)]="selectedLoanType" [settings]="loanSettings">
                                        </ng-multiselect-dropdown>
                                        <label style="color: red;font-size: 12px;" *ngIf="error?.loantype">{{ error?.loantype }}</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div  class="form-group"><label 
                                        class="form-label">Amount *</label><input 
                                        name="example-password-input" placeholder="Enter Amount" type="number" style="border: 1px solid #c5c5c5;"
                                         [(ngModel)]="Amount" class="form-control" (input)="digitsOnly($event, 'Amount')">
                                         <label style="color: red;font-size: 12px;" *ngIf="error?.amount">{{ error?.amount }}</label>
                                        </div>
                                </div>
                                <div class="col-md-3">
                                    <div  class="form-group"><label 
                                        class="form-label">Reason For Loan *</label><input 
                                        name="example-password-input" placeholder="Enter Reason" type="text" style="border: 1px solid #c5c5c5;"
                                         [(ngModel)]="ReasonForLoan" class="form-control">
                                          <label style="color: red;font-size: 12px;" *ngIf="error?.loan">{{ error?.loan }}</label></div>
                                </div>
                                <div class="col-md-3">
                                    <div  class="form-group"><label 
                                        class="form-label">Monthly Deduction *</label><input 
                                        name="example-password-input" placeholder="Enter Deduction" type="number" style="border: 1px solid #c5c5c5;"
                                         [(ngModel)]="MonthlyDeduction" class="form-control" (input)="digitsOnly($event, 'MonthlyDeduction')">
                                         <label style="color: red;font-size: 12px;" *ngIf="error?.deduction">{{ error?.deduction }}</label></div>
                                </div>

                                <div class="col-md-1">
                                    <div class="form-group">
                                        <label class="form-label">.</label>
                                        <button  id="table2-new-row-button" class="btn btn-primary mb-4" style="border-radius:10px;background-color: #3601b5a3;" (click)="ApplyLoanRequest();">Submit</button>

                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>